import xml.dom.minidom as xdm
import re

doc = xdm.Document()
rootNode = doc.createElement("herbs")
rootNode.setAttribute("name","本草纲目")
doc.appendChild(rootNode)
file=open("./本草纲目.txt",encoding="utf-8").read()
name=re.compile("当前页：.*?下一页")
names=re.findall(name,file)
tp=re.split("下一页：",file)
print(len(tp))
i=0
# print(len(names))
for n in names:
    # print(n[4:-3])
    herb_node=doc.createElement("herb")
    herb_node.setAttribute("name",n[4:-3])
    rootNode.appendChild(herb_node)
    h=re.split("「释名」",tp[i])
    if len(h)>1:
        f = re.split("「气味」", h[1])
        nick_name_node=doc.createElement("nick_name")
        nick_name=doc.createTextNode(f[0])
        nick_name_node.appendChild(nick_name)
        herb_node.appendChild(nick_name_node)
        if len(f)<2:
            print("无气味")
            smell_node = doc.createElement("smell")
            smell = doc.createTextNode("")
            smell_node.appendChild(smell)
            herb_node.appendChild(smell_node)
        else:
            d=re.split("「主治」",f[1])
            smell_node = doc.createElement("smell")
            smell = doc.createTextNode(d[0])
            smell_node.appendChild(smell)
            herb_node.appendChild(smell_node)
        a=re.split("上一页",d[1])
        major_node = doc.createElement("major")
        major_name = doc.createTextNode(a[0])
        major_node.appendChild(major_name)
        herb_node.appendChild(major_node)
    else:
        f = re.split("「气味」", h[0])
        if len(f)<2:
            print("无气味")
            smell_node = doc.createElement("smell")
            smell = doc.createTextNode("")
            smell_node.appendChild(smell)
            herb_node.appendChild(smell_node)
        else:
            d=re.split("「主治」",f[1])
            smell_node = doc.createElement("smell")
            smell = doc.createTextNode(d[0])
            smell_node.appendChild(smell)
            herb_node.appendChild(smell_node)
        a=re.split("上一页",d[1])
        major_node = doc.createElement("major")
        major_name = doc.createTextNode(a[0])
        major_node.appendChild(major_name)
        herb_node.appendChild(major_node)
        print("无释名")
        nick_name_node=doc.createElement("nick_name")
        nick_name=doc.createTextNode("")
        nick_name_node.appendChild(nick_name)
        herb_node.appendChild(nick_name_node)
    i+=1
fp=open("本草纲目.xml",mode="w")
doc.writexml(fp,indent='\t', addindent='\t', newl='\n', encoding="utf-8")
# illness=re.compile("[0-9]+、.*?。")
# illnesses=re.findall(illness,file)
# print(illnesses)
